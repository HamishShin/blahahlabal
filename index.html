<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Light Puzzle Builder</title>
<style>
  body {
    background: #111;
    color: white;
    font-family: sans-serif;
    text-align: center;
  }

  svg {
    background: #1a1a1a;
    border-radius: 10px;
    margin-top: 10px;
  }

  circle {
    cursor: pointer;
    transition: fill 0.15s;
  }

  text {
    pointer-events: none;
    font-size: 14px;
    font-weight: bold;
    fill: white;
    text-anchor: middle;
    dominant-baseline: middle;
  }

  button, select, input {
    margin: 5px;
  }
</style>
</head>

<body>

<h2>Light Puzzle Builder</h2>

<select id="shapeSelect">
  <option value="grid">Grid</option>
  <option value="ring">Ring</option>
  <option value="star">Star Graph</option>
</select>

<button id="modeBtn">Mode: EDIT</button>
<button id="randomBtn">Randomize</button>
<button id="displayBtn">Display: COLORS</button>

<br>
States (k):
<input type="number" id="stateCount" value="3" min="2" max="6">

<div id="controls"></div>

<svg id="svg" width="500" height="500"></svg>

<script>
const svg = document.getElementById("svg");
const controls = document.getElementById("controls");
const shapeSelect = document.getElementById("shapeSelect");
const modeBtn = document.getElementById("modeBtn");
const randomBtn = document.getElementById("randomBtn");
const displayBtn = document.getElementById("displayBtn");
const stateCountInput = document.getElementById("stateCount");

const SIZE = 500;
const R = 12;
const COLORS = ["#ff0000","#0000ff","#00ff00","#ffff00","#ff00ff","#00ffff"];

let k = 3;
let nodes = [];
let labels = [];
let positions = [];
let adjacency = () => [];
let editMode = true;
let displayMode = "colors";
let shape = "grid";

/* ---------- CORE ---------- */

function clear() {
  svg.innerHTML = "";
  nodes = [];
  labels = [];
  positions = [];
}

function createNode(x, y, i) {
  positions[i] = {x,y};

  const c = document.createElementNS("http://www.w3.org/2000/svg","circle");
  c.setAttribute("cx",x);
  c.setAttribute("cy",y);
  c.setAttribute("r",R);
  c.dataset.state = "0";

  const t = document.createElementNS("http://www.w3.org/2000/svg","text");
  t.setAttribute("x",x);
  t.setAttribute("y",y);

  c.onclick = () => {
    if (editMode) increment(i);
    else adjacency(i).forEach(increment);
  };

  svg.appendChild(c);
  svg.appendChild(t);
  nodes.push(c);
  labels.push(t);
  update(i);
}

function increment(i) {
  nodes[i].dataset.state = (+nodes[i].dataset.state + 1) % k;
  update(i);
}

function update(i) {
  const s = +nodes[i].dataset.state;
  nodes[i].setAttribute("fill", COLORS[s]);
  labels[i].textContent = s;
  labels[i].style.display = displayMode === "numbers" ? "block" : "none";
}

/* ---------- EDGES ---------- */

function drawEdges() {
  const g = document.createElementNS("http://www.w3.org/2000/svg","g");
  positions.forEach((p,i)=>{
    adjacency(i).forEach(j=>{
      if(j>i){
        const q = positions[j];
        const l = document.createElementNS("http://www.w3.org/2000/svg","line");
        l.setAttribute("x1",p.x);
        l.setAttribute("y1",p.y);
        l.setAttribute("x2",q.x);
        l.setAttribute("y2",q.y);
        l.setAttribute("stroke","#666");
        l.setAttribute("stroke-width","2");
        g.appendChild(l);
      }
    });
  });
  svg.prepend(g);
}

/* ---------- GRID WITH STRETCH ---------- */

function drawGrid(rows, cols, sx, sy) {
  clear();
  const ox = SIZE/2 - (cols-1)*sx/2;
  const oy = SIZE/2 - (rows-1)*sy/2;

  for(let r=0;r<rows;r++){
    for(let c=0;c<cols;c++){
      createNode(
        ox + c*sx,
        oy + r*sy,
        r*cols+c
      );
    }
  }

  adjacency = i => {
    const r = Math.floor(i/cols);
    const c = i%cols;
    const a=[i];
    if(r>0) a.push(i-cols);
    if(r<rows-1) a.push(i+cols);
    if(c>0) a.push(i-1);
    if(c<cols-1) a.push(i+1);
    return a;
  };

  drawEdges();
}

/* ---------- RING ---------- */

function drawRing(n) {
  clear();
  const cx = SIZE/2, cy = SIZE/2, rad = 180;

  for(let i=0;i<n;i++){
    const a = 2*Math.PI*i/n;
    createNode(cx+Math.cos(a)*rad, cy+Math.sin(a)*rad, i);
  }

  adjacency = i => [i,(i-1+n)%n,(i+1)%n];
  drawEdges();
}

/* ---------- STAR GRAPH ---------- */

function drawStar(leaves) {
  clear();
  const cx = SIZE/2, cy = SIZE/2;

  createNode(cx,cy,0);

  for(let i=1;i<=leaves;i++){
    const a = 2*Math.PI*(i-1)/leaves;
    createNode(cx+Math.cos(a)*180, cy+Math.sin(a)*180, i);
  }

  adjacency = i => i===0
    ? [...Array(leaves).keys()].map(j=>j+1).concat(0)
    : [0,i];

  drawEdges();
}

/* ---------- UI ---------- */

function updateControls(){
  controls.innerHTML = "";

  if(shape==="grid"){
    controls.innerHTML = `
      Rows <input id="rows" type="number" value="5" min="2" max="10">
      Cols <input id="cols" type="number" value="5" min="2" max="10"><br>
      Stretch X <input id="sx" type="range" min="30" max="120" value="70">
      Stretch Y <input id="sy" type="range" min="30" max="120" value="70">
    `;

    const redraw = () =>
      drawGrid(+rows.value,+cols.value,+sx.value,+sy.value);

    rows.oninput = redraw;
    cols.oninput = redraw;
    sx.oninput = redraw;
    sy.oninput = redraw;

    redraw();
  }

  if(shape==="ring"){
    controls.innerHTML = `
      Nodes <input id="n" type="range" min="3" max="40" value="12">
    `;
    n.oninput = ()=>drawRing(+n.value);
    drawRing(12);
  }

  if(shape==="star"){
    controls.innerHTML = `
      Leaves <input id="l" type="range" min="3" max="20" value="8">
    `;
    l.oninput = ()=>drawStar(+l.value);
    drawStar(8);
  }
}

shapeSelect.onchange = ()=>{
  shape = shapeSelect.value;
  updateControls();
};

modeBtn.onclick = ()=>{
  editMode = !editMode;
  modeBtn.textContent = `Mode: ${editMode?"EDIT":"PLAY"}`;
};

displayBtn.onclick = ()=>{
  displayMode = displayMode==="colors"?"numbers":"colors";
  displayBtn.textContent = `Display: ${displayMode.toUpperCase()}`;
  nodes.forEach((_,i)=>update(i));
};

randomBtn.onclick = ()=>{
  nodes.forEach((n,i)=>{
    n.dataset.state = Math.floor(Math.random()*k);
    update(i);
  });
};

stateCountInput.onchange = ()=>{
  k = Math.max(2,+stateCountInput.value);
  nodes.forEach((n,i)=>{
    n.dataset.state %= k;
    update(i);
  });
};

updateControls();
</script>

</body>
</html>
